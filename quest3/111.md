##### 제한된 용량의 Docker에서 파일 용량의 오류가 날 때는?#####

**1-1) Docker 서비스 중지**
```bash
systemctl stop docker
```

```tech
systemctl
```

**1-2) 도커 PID 파일 및 데이터 삭제**
```bash
rm -f /var/run/docker.pid && rm -rf /xfs_quota/dockerdata/*
```

```tech
rm
```
**1-3) 도커 데몬 수동 실행 (데이터 루트 지정)**
```bash
nohup dockerd --data-root=/xfs_quota/dockerdata > /var/log/dockerd.log 2>&1 &
```

```tech
nohub
```


**2-1) 도커 컨테이너 실행시 스토리지 용량 제한**
```bash
docker run -it -d --storage-opt size=2G --name xfstest2g ubuntu:22.04
```

```tech
docker
```

**2-2) 컨테이너 진입**
```bash
docker exec -it xfstest2g bash
```

```tech
docker
```

**3-1) 작업 디렉터리 생성**
```bash
mkdir /workspace
```

```tech
mkdir
```

**3-2) 작업 디렉터리 이동**
```bash
cd /workspace
```

```tech
cd
```

**4)  패키지 리스트 업데이트 및 wget 설치**
```bash
apt update && apt install -y wget
```

```tech
apt
```

**5-1) 모델 다운로드**
```bash
wget https://huggingface.co/gpt2-medium/resolve/main/pytorch_model.bin -O /workspace/gpt2-medium.bin
```

```tech
wget
```

**5-2) 영상 다운로드 ( 오류 발생 )**
```bash
wget http://xcal1.vodafone.co.uk/1GB.zip -O /workspace/sample_video_1GB.zip
```

```tech
wget
```



**6)현재 디렉터리의 디스크 사용량 확인.**
```bash
df -h .
```
- `df -h .` : 현재 폴더가 속한 파일시스템의 전체 용량과 남은 공간 확인
- `du -h .` : 각 파일과 폴더가 사용 중인 용량 간단히 확인
- `ls -lh /workspace` : /workspace 폴더 파일과 크기를 사람 읽기 좋은 단위로 표시

```tech
df
```

**7-1) 현재 디렉토리에서 용량을 가장 많이 차지하는 파일들 확인.**
* 현재 디렉터리 내에서 용량이 큰 상위 10개 파일과 폴더를 크기 순으로 정렬해 보여줍니다.

- `ls -alh` : 숨김 파일 포함(-a), 상세 정보(-l), 사람이 읽기 좋은 단위(-h)로 출력.
- `sort -h` : 사람이 읽기 좋은 단위(K, M, G) 기준으로 정렬 (오름차순) 
- `head -10` : 상위 10개만 출력

```bash
ls -alh | sort -h | head -10
```

```tech
ls
```

**7-2) 현재 디렉토리에서 오랫동안 사용 하지 않은 파일들을 확인.**
* 오래 사용하지 않은 파일을 찾아서 최근 접근 시간 순으로 정렬해 상위 10개를 보여줍니다.

- `find . -type f` : 현재 폴더 내 파일만 찾기  
- `stat -c '%X %n'` : 각 파일의 마지막 접근시간(UNIX timestamp)과 이름 출력  
- `2>/dev/null` : 에러 메시지 숨김  
- `sort -n` : 접근시간 기준 오름차순 정렬 (오래된 것부터)  
- `head -10` : 상위 10개만 출력  

```bash
find . -type f -exec stat -c '%X %n' {} + 2>/dev/null | sort -n | head -10
```

```tech
find
```

**8-1) 컨테이너 내부에서 종료**
```bash
exit
```

```tech
exit
```

**8-2) 기존 컨테이너 강제 삭제**
```bash
docker rm -f xfstest2g
```

```tech
docker
```

**8-3) 용량을 4GB로 늘려서 도커 생성**
```bash
docker run -it -d --storage-opt size=4G --name xfstest4g ubuntu:22.04
```

```tech
docker
```

**8-4) 컨테이너 진입**
```bash
docker exec -it xfstest4g bash
```

```tech
docker
```

**9-1) 작업 디렉터리 생성**
```bash
mkdir /workspace
```

```tech
mkdir
```

**9-2) 작업 디렉터리 이동**
```bash
cd /workspace
```

```tech
cd
```

**9-3)  패키지 리스트 업데이트 및 wget 설치**
```bash
apt update && apt install -y wget
```

```tech
apt
```

**10) 디스크 사용량 확인( df,du,ls 모두 이용해서 확인 가능)**
```bash
df -h .
```

```tech
df
```

**11-1) 모델 다운로드**
```bash
wget https://huggingface.co/gpt2-medium/resolve/main/pytorch_model.bin -O /workspace/gpt2-medium.bin
```

```tech
wget
```

**11-2) 샘플 영상 다운로드**
```bash
wget http://xcal1.vodafone.co.uk/1GB.zip -O /workspace/sample_video_1GB.zip
```

```tech
wget
```


**12-1) 현재 디렉토리에서 용량을 가장 많이 차지하는 파일들 확인.**
* 현재 디렉터리 내에서 용량이 큰 상위 10개 파일과 폴더를 크기 순으로 정렬해 보여줍니다.

- `ls -alh` : 숨김 파일 포함(-a), 상세 정보(-l), 사람이 읽기 좋은 단위(-h)로 출력.
- `sort -h` : 사람이 읽기 좋은 단위(K, M, G) 기준으로 정렬 (오름차순) 
- `head -10` : 상위 10개만 출력

```bash
ls -alh | sort -h | head -10
```

```tech
ls
```

**12-2) 현재 디렉토리에서 오랫동안 사용 하지 않은 파일들을 확인.**
* 오래 사용하지 않은 파일을 찾아서 최근 접근 시간 순으로 정렬해 상위 10개를 보여줍니다.

- `find . -type f` : 현재 폴더 내 파일만 찾기  
- `stat -c '%X %n'` : 각 파일의 마지막 접근시간(UNIX timestamp)과 이름 출력  
- `2>/dev/null` : 에러 메시지 숨김  
- `sort -n` : 접근시간 기준 오름차순 정렬 (오래된 것부터)  
- `head -10` : 상위 10개만 출력  

```bash
find . -type f -exec stat -c '%X %n' {} + 2>/dev/null | sort -n | head -10
```

```tech
find
```


**13) 저장 공간 확인**
```bash
df -h .
```

```tech
df
```
